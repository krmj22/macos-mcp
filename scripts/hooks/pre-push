#!/bin/bash
# Pre-push hook: test, build, and restart LaunchAgent
# Ensures pushed code passes tests and the running server reflects it.

set -e

echo "üß™ Running tests..."
pnpm test

echo "üî® Building project..."
pnpm build

# Restart LaunchAgent if it's registered (only relevant on production Mac)
LABEL="com.macos-mcp.server"
if launchctl list "$LABEL" &>/dev/null; then
  echo "‚ôªÔ∏è  Restarting LaunchAgent..."
  launchctl kickstart -k "gui/$(id -u)/$LABEL"
  echo "‚úÖ Server restarted with latest build"
else
  echo "‚ÑπÔ∏è  LaunchAgent not running, skipping restart"
fi
